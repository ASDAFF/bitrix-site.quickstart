function setQuantity(t,e,a){var i=BX("QUANTITY_INPUT_"+t).value,o=$("#QUANTITY_INPUT_"+t).data("float_ratio"),e=o?parseFloat(e):parseInt(e,10);o&&(e=Math.round(e*arOptimusOptions.JS_ITEM_CLICK.precisionFactor)/arOptimusOptions.JS_ITEM_CLICK.precisionFactor),curValue=o?parseFloat(i):parseInt(i,10),curValue="up"==a?curValue+e:curValue-e,o&&(curValue=Math.round(curValue*arOptimusOptions.JS_ITEM_CLICK.precisionFactor)/arOptimusOptions.JS_ITEM_CLICK.precisionFactor),curValue<0&&(curValue=0),curValue>0&&(BX("QUANTITY_INPUT_"+t).value=curValue,BX("QUANTITY_INPUT_"+t).defaultValue=i,totalSum=0,$("#basket_line .basket_fly tr[data-id="+t+"]").closest("table").find("tbody tr[data-id]").each(function(t,e){id=$(e).attr("data-id"),count=BX("QUANTITY_INPUT_"+id).value,price=$(document).find("#basket_form input[name=item_price_"+id+"]").val(),sum=count*price,totalSum+=sum,$(document).find("#basket_form [data-id="+id+"] .summ-cell .price").html(jsPriceFormat(sum))}),$("#basket_form .itog span.price").html(jsPriceFormat(totalSum)),$("#basket_form .itog div.discount").fadeTo("slow",.2),timerBasketUpdate&&(clearTimeout(timerBasketUpdate),timerBasketUpdate=!1),timerBasketUpdate=setTimeout(function(){updateQuantity("QUANTITY_INPUT_"+t,t,e),timerBasketUpdate=!1},700))}function updateQuantity(t,e,a,i){var o=BX(t).defaultValue,r=parseFloat(BX(t).value)||0;bValidChange=!1,r||(bValidChange=!1,BX(t).value=o),$("#"+t).hasClass("focus")&&(r-=r%a);var u=a%1==0;if(r=u?parseInt(r):parseFloat(r).toFixed(1),isRealValue(BX("QUANTITY_SELECT_"+e)))var s,n=BX("QUANTITY_SELECT_"+e).options,l=n.length;for(;l--;)s=n[l],parseFloat(s.value).toFixed(2)==parseFloat(r).toFixed(2)&&(s.selected=!0);BX("QUANTITY_"+e).value=r,BX("QUANTITY_INPUT_"+e).value=r,$("form[name^=basket_form]").prepend('<input type="hidden" name="BasketRefresh" value="Y" />'),$.post(arOptimusOptions.SITE_DIR+"ajax/basket_fly.php",$("form[name^=basket_form]").serialize(),$.proxy(function(t){0==timerBasketUpdate&&basketFly("open"),$("form[name^=basket_form] input[name=BasketRefresh]").remove()}))}function delete_all_items(t,e,a){var i="delay"==t?"2":"1";$.post(arOptimusOptions.SITE_DIR+"ajax/show_basket_fly.php","PARAMS="+$("#basket_form").find("input#fly_basket_params").val()+"&TYPE="+i+"&CLEAR_ALL=Y",$.proxy(function(t){basketFly("open"),$(".in-cart").hide(),$(".in-cart").closest(".button_block").removeClass("wide"),$(".to-cart").show(),$(".counter_block").show(),$(".wish_item").removeClass("added"),$(".wish_item").find(".value").show(),$(".wish_item").find(".value.added").hide(),getActualBasket()}))}function deleteProduct(t,e,a,i){function o(t,e,a){$.post(arOptimusOptions.SITE_DIR+"ajax/item.php","delete_item=Y&item="+a,$.proxy(function(t){basketFly("open"),getActualBasket()}))}var r=i.attr("product-id");checkCounters()?(delFromBasketCounter(a),setTimeout(function(){o(t,e,r)},100)):o(t,e,r)}function delayProduct(t,e,a){var i=a.attr("product-id");$.post(arOptimusOptions.SITE_DIR+"ajax/item.php","wish_item=Y&item="+i+"&quantity="+a.find("#QUANTITY_"+t).val(),$.proxy(function(t){basketFly("open"),getActualBasket(a.attr("data-iblockid"))}))}function addProduct(t,e,a){var i=a.attr("product-id");$.post(arOptimusOptions.SITE_DIR+"ajax/item.php","add_item=Y&item="+i+"&quantity="+a.find("#QUANTITY_"+t).val(),$.proxy(function(t){basketFly("open"),getActualBasket(a.attr("data-iblockid"))}))}function checkOut(t){t=t||window.event;var e=$(t.target).parent();return checkCounters("google")?checkoutCounter(1,e.data("text"),e.data("href")):location.href=e.data("href"),!0}var basketTimeout,totalSum,timerBasketUpdate=!1;