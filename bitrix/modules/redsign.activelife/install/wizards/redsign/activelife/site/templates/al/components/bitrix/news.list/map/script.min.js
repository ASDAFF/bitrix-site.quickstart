function drawPlacemark(e,s){e.each(function(){$(this).is(":visible")?s[$(this).data("id")].options.set("visible",!0):s[$(this).data("id")].options.set("visible",!1)})}$(document).ready(function(){function e(e,s){var t=function(e,s){return s.replace(new RegExp("("+e+")","gi"),"<span>$1</span>")};e.each(function(e,i){var n=$(i),a=n.find(".js-item__name").html(),o=n.find(".js-item__descr").html();return a=a.replace(new RegExp("<span>(.*?)</span>","gi"),"$1"),o=o.replace(new RegExp("<span>(.*?)</span>","gi"),"$1"),s?(a&&(a.replace(new RegExp("<span>(.*?)</span>","gi"),"$1"),n.find(".js-item__name").html(t(s,a))),void(o&&(o.replace(new RegExp("<span>(.*?)</span>","gi"),"$1"),n.find(".js-item__descr").html(t(s,o))))):(n.find(".js-item__name").html(a.replace(new RegExp("<span>(.*?)</span>","gi"),"$1")),void n.find(".js-item__descr").html(o.replace(new RegExp("<span>(.*?)</span>","gi"),"$1")))})}var s,t=$(".js-shops_list").find(".js-item"),i=[0,0],n={},a="active";t.each(function(){var e=$(this).data("coords").split(",");i[0]=i[0]+parseFloat(e[0]),i[1]=i[1]+parseFloat(e[1])}),i[0]=i[0]/t.length,i[1]=i[1]/t.length;var s,n={};ymaps.ready(function(){s=new ymaps.Map("rsYMapShops",{center:i,zoom:14,type:"yandex#publicMap",behaviors:["default","scrollZoom"]}),t.each(function(){var e=$(this).data("coords").split(","),t=$(this).data("id");e[0]=parseFloat(e[0]),e[1]=parseFloat(e[1]),n[t]=new ymaps.Placemark(e,{balloonContentHeader:$(this).find(".js-item__name").html(),balloonContentBody:$(this).find(".js-item__descr").html()}),s.geoObjects.add(n[t])}),s.setBounds(s.geoObjects.getBounds(),{checkZoomRange:!0})}),t.on("mouseenter",function(){n[$(this).data("id")].options.set("preset","twirl#redDotIcon")}).on("mouseleave",function(){n[$(this).data("id")].options.set("preset","twirl#blueIcon")}),$(document).on("keyup",".js-search_city input",function(){var s,t,i,n,a=$(this),o=a.val(),d=$(".js-filter .js-btn.active").data("filter"),p=$([]);s=d?$(".js-shops_list .js-item[data-type="+d+"]"):$(".js-shops_list .js-item"),o&&""!=o.trim()?($(".js-clear-shops-input").addClass("active"),$.each(s,function(e,s){t=$(s),i=t.find(".js-item__name").text(),n=t.find(".js-item__descr").text(),(i&&i.toLowerCase().indexOf(o.toLowerCase())!==-1||n&&n.toLowerCase().indexOf(o.toLowerCase())!==-1)&&(p=p.add(t))})):(p=s,$(".js-clear-shops-input").removeClass("active")),s.addClass("hidden"),p.length>0?(p.removeClass("hidden"),$(".js-not-found:visible").hide()):$(".js-not-found:hidden").show(),e(p,o)}),$(document).on("click",".js-shops_list .js-item",function(){var e=$(this).data("coords");e&&(e=e.split(","),e=$.map(e,function(e){return parseFloat(e,10)}),s.setCenter(e,18),appSLine.getPageWidth()<=appSLine.grid.md&&$(window).scrollTop($("#rsYMapShops").offset().top))}),$(document).on("blur",".js-search_city input",function(){var e=$(this).val();e.length<1?$(".js-shops_list").find(".js-item").show():$(".js-search_city input").trigger("keyup"),drawPlacemark(t,n)}),$(document).on("click",".js-filter .js-btn",function(){$(".js-shops .js-filter").find(".js-btn").removeClass(a),$(this).addClass(a);var e=$(this).data("filter");e.length>0?($(".js-shops_list").find(".js-item").hide(),$(".js-shops_list").find('.js-item[data-type="'+e+'"]').show()):$(".js-shops_list").find(".js-item").show(),$(".js-search_city input").trigger("keyup"),drawPlacemark(t,n)}),$(document).on("click",".js-clear-shops-input",function(){$(".js-search_city .shops-input").val("").keyup()})});