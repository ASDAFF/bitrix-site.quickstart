!function(e){BX.namespace("BX.Forum");var t=function(e){if(this.id="FTRList"+e.form.id,this.mess={},this.form=e.form,e.id)for(var t=0;t<e.id.length;t++)this.bind(e.id[t]);this.params={preorder:"Y"==e.preorder,pageNumber:e.pageNumber,pageCount:e.pageCount},BX.addCustomEvent(this.form,"onAdd",BX.delegate(this.add,this)),BX.addCustomEvent(this.form,"onRequest",BX.delegate(function(){if("undefined"!=typeof this.params.pageNumber){var e=this.form.elements.pageNumber;e||(e=BX.create("input",{props:{type:"hidden",name:"pageNumber"}}),this.form.appendChild(e)),e.value=this.params.pageNumber}if("undefined"!=typeof this.params.pageCount){var t=BX.findChild(this.form,{attr:{name:"pageCount"}});t||(t=BX.create("input",{props:{type:"hidden",name:"pageCount"}}),this.form.appendChild(t)),t.value=this.params.pageCount}},this)),BX.addCustomEvent(this.form,"onResponse",BX.delegate(function(){var e=BX.findChild(this.form,{attr:{name:"pageNumber"}},!0);e&&BX.remove(e)},this))};t.prototype={add:function(t,s){var i,a=BX(this.form.id+"container"),r={className:/reviews-reply-form|reviews-collapse/},o=e.fTextToNode(s.message);if(a||(a=BX.create("div",{attrs:{id:this.form.id+"container"},props:{className:"reviews-block-container reviews-reviews-block-container"}}),e.fReplaceOrInsertNode(a,null,BX.findChild(document,r,!0).parentNode,r),a=BX(this.form.id+"container")),i=a?BX.findChild(a,{className:"reviews-block-inner"},!0):null,o&&i){if(s.allMessages){if(e.fReplaceOrInsertNode(o,i,BX.findChild(document,r,!0).parentNode,r),s.navigation&&s.pageNumber){var n,l=e.fTextToNode(s.navigation),d=l?BX.findChildren(a.parentNode,{className:"reviews-navigation-box"},!0):null;if(l){if(!d){a.parentNode.insertBefore(BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-top"}}),a);var f=a;do f=f.nextSibling;while(f&&1!=f.nodeType);var h=BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-bottom"}});f?a.parentNode.insertBefore(h,f):a.parentNode.appendChild(h),d=BX.findChildren(a.parentNode,{className:"reviews-navigation-box"},!0)}for(n=0;n<d.length;n++)d[n].innerHTML=l.innerHTML}this.params.pageNumber=s.pageNumber,this.params.pageCount=s.pageCount}if(s.messagesID&&"object"==typeof s.messagesID)for(var c=0;c<s.messagesID.length;c++)s.messagesID[c]!=t&&this.bind(s.messagesID[c])}else"undefined"!=typeof s.message&&(this.params.preorder?i.appendChild(o):i.insertBefore(o,i.firstChild));e.fRunScripts(s.message),this.bind(t)}},bind:function(e){var t=BX("message"+e);if(t){this.mess["m"+e]={node:t,author:{id:t.getAttribute("bx-author-id"),name:t.getAttribute("bx-author-name")}};var s=BX.findChildren(t,{tagName:"A",className:"reviews-button-small"},!0),i=BX.delegate(function(){var t=BX.proxy_context;this.act(t.getAttribute("bx-act"),e)},this),a=BX.delegate(function(){this.act("reply",e)},this),r=BX.delegate(function(){this.act("quote",e)},this);if(s&&s.length>0)for(var o=0;o<s.length;o++)"moderate"==s[o].getAttribute("bx-act")||"del"==s[o].getAttribute("bx-act")?BX.adjust(s[o],{events:{click:i},attrs:{"bx-href":s[o].getAttribute("href"),href:"javascript:void(0);"}}):this.form&&("reply"==s[o].getAttribute("bx-act")?BX.bind(s[o],"click",a):"quote"==s[o].getAttribute("bx-act")&&BX.bind(s[o],"mousedown",r))}},act:function(t,s){if(s&&this.mess["m"+s])if("quote"==t){var i=e.GetSelection();if(document.getSelection&&(i=i.replace(/\r\n\r\n/gi,"_newstringhere_").replace(/\r\n/gi," "),i=i.replace(/	/gi,"").replace(/_newstringhere_/gi,"\r\n\r\n")),""===i&&s>0&&BX("message_text_"+s,!0)){var a=BX("message_text_"+s,!0);"object"==typeof a&&a&&(i=a.innerHTML)}i=i.replace(/[\n|\r]*<br(\s)*(\/)*>/gi,"\n");var r=function(e,t){var s=" ",i=/showWMVPlayer.*?bx_wmv_player.*?file:[\s'"]*([^"']*).*?width:[\s'"]*([^"']*).*?height:[\s'"]*([^'"]*).*?/gi,a=i.exec(t);if(a&&(s="[VIDEO WIDTH="+a[2]+" HEIGHT="+a[3]+"]"+a[1]+"[/VIDEO]")," "==s){var r=/bxPlayerOnload[\s\S]*?[\s'"]*file[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*height[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*width[\s'"]*:[\s'"]*([^"']*)/gi;a=r.exec(t),a&&(s="[VIDEO WIDTH="+a[3]+" HEIGHT="+a[2]+"]"+a[1]+"[/VIDEO]")}return s};i=i.replace(/<script[^>]*>/gi,"").replace(/<\/script[^>]*>/gi,""),i=i.replace(/\001([^\002]*)\002/gi,r),i=i.replace(/<noscript[^>]*>/gi,"").replace(/<\/noscript[^>]*>/gi,""),i=i.replace(/\003([^\004]*)\004/gi," "),i=i.replace(/<table class\=[\"]*forum-quote[\"]*>[^<]*<thead>[^<]*<tr>[^<]*<th>([^<]+)<\/th><\/tr><\/thead>[^<]*<tbody>[^<]*<tr>[^<]*<td>/gi,""),i=i.replace(/<table class\=[\"]*forum-code[\"]*>[^<]*<thead>[^<]*<tr>[^<]*<th>([^<]+)<\/th><\/tr><\/thead>[^<]*<tbody>[^<]*<tr>[^<]*<td>/gi,""),i=i.replace(/<table class\=[\"]*data-table[\"]*>[^<]*<tbody>/gi,""),i=i.replace(/<\/td>[^<]*<\/tr>(<\/tbody>)*<\/table>/gi,""),i=i.replace(/[\r|\n]{2,}([\001|\002])/gi,"\n$1");for(var o=0;o++<50&&(i.search(/\002([^\002\003]*)\003/gi)>=0||i.search(/\001([^\001\003]*)\003/gi)>=0);)i=i.replace(/\002([^\002\003]*)\003/gi,"[CODE]$1[/CODE]").replace(/\001([^\001\003]*)\003/gi,"[QUOTE]$1[/QUOTE]");var n=function(e,t,s){for(var i=new RegExp("([^]*)("+t+")([^]*)","i"),a=new RegExp("((?:)(?:[^]*))("+t+")((?:[^]*)(?:))","i"),r=0;r++<300&&e.search(i)>=0;)e=e.replace(a,"$1"+s+"$3");return e};for(o=0;o++<10&&i.search(/\004([^\004\003]*)\003/gi)>=0;)i=n(i,"<tr>","[TR]"),i=n(i,"</tr>","[/TR]"),i=n(i,"<td>","[TD]"),i=n(i,"</td>","[/TD]"),i=i.replace(/\004([^\004\003]*)\003/gi,"[TABLE]$1[/TD][/TR][/TABLE]");i=BX.browser.IsIE()?i.replace(/<img(?:(?:\s+alt\s*=\s*\"?smile([^\"\s]+)\"?)|(?:\s+\w+\s*=\s*[^\s>]*))*>/gi,"$1"):i.replace(/<img.*?alt=[\"]*smile([^\"\s]+)[\"]*[^>]*>/gi,"$1"),i=i.replace(/<a[^>]+href=[\"]([^\"]+)\"[^>]+>([^<]+)<\/a>/gi,"[URL=$1]$2[/URL]"),i=i.replace(/<a[^>]+href=[\']([^\']+)\'[^>]+>([^<]+)<\/a>/gi,"[URL=$1]$2[/URL]"),i=i.replace(/<[^>]+>/gi," ").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"'),i=i.replace(/(smile(?=[:;8]))/g,""),i=i.replace(/\&shy;/gi,""),i=i.replace(/\&nbsp;/gi," "),BX.onCustomEvent(this.form,"onQuote",[{author:this.mess["m"+s].author,id:s,text:i}])}else if("reply"==t)BX.onCustomEvent(this.form,"onReply",[{author:this.mess["m"+s].author,id:s}]);else if("del"!=t||confirm(BX.message("f_cdm"))){if("moderate"==t||"del"==t){var l=BX.proxy_context,d=l.getAttribute("bx-href").replace(/.AJAX_CALL=Y/g,"").replace(/.sessid=[^&]*/g,""),f=BX.findParent(l,{tag:"table"}),h=BX.create("a",{attrs:{className:"reply-action-note"}}),c=function(){BX.remove(h),BX.show(l.parentNode)};BX.hide(l.parentNode),h.innerHTML=BX.message("f_wait"),l.parentNode.parentNode.appendChild(h),BX.ajax.loadJSON(d,{AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},BX.delegate(function(s){if(s.status&&f)if(BX.onCustomEvent(e,"onForumCommentAJAXAction",[t]),"del"==t){var i=e.curpage||top.window.location.href;BX.fx.hide(f,"scroll",{time:.15,callback_complete:BX.delegate(function(){BX.remove(f),c();var e=BX.findChild(BX(this.form.id+"container"),{class:"reviews-post-table"},!0,!0);(!e||e.length<1)&&this.params.pageNumber>1&&BX.reload(i)},this)})}else{var a=BX.hasClass(f,"reviews-post-hidden"),r=a?BX.message("f_hide"):BX.message("f_show"),o=BX.findChild(f,{className:"reviews-text"},!0);BX.fx.hide(o,"fade",{time:.1,callback_complete:function(){BX.toggleClass(f,"reviews-post-hidden"),l.innerHTML=r,d=d.replace(new RegExp("REVIEW_ACTION="+(a?"SHOW":"HIDE")),"REVIEW_ACTION="+(a?"HIDE":"SHOW")),l.setAttribute("bx-href",d),BX.fx.show(o,"fade",{time:.1}),c(),BX.style(o,"background-color",a?"#FFFFFF":"#E5F8E3")}})}else BX.addClass(h,"error"),h.innerHTML='<span class="errortext">'+s.message+"</span>"},this))}}else BX.DoNothing();else BX.DoNothing();return!1}};var s=function(){var t=function(e,t){if(this.id="FTRForm"+e.form.id,this.form=e.form,this.editor=t,this.windowEvents={},this.params={messageMax:64e3},this.onsuccess=BX.delegate(this.onsuccess,this),this.onfailure=BX.delegate(this.onfailure,this),this.submit=BX.delegate(this.submit,this),BX.bind(this.form,"submit",this.submit),this.isAjax="Y"==e.ajaxPost,"Y"==e.captcha){var s=new Captcha(this.form);BX.ready(function(){BX.bind(BX("forum-refresh-captcha"),"click",BX.proxy(s.Update,s))}),"Y"==e.bVarsFromForm&&s.Show()}BX.addCustomEvent(this.form,"onQuote",BX.delegate(function(e){this.show(),this.quote(e)},this)),BX.addCustomEvent(this.form,"onReply",BX.delegate(function(e){this.show(),this.paste(e)},this)),BX.addCustomEvent(this.form,"onTransverse",BX.delegate(this.transverse,this))};return t.prototype={submit:function(e){if(this.validate()){if(this.prepareForm(),this.disableButtons(!0),!this.isAjax)return!0;this.send()}return BX.PreventDefault(e)},prepareForm:function(){},disableButtons:function(e){for(var t=this.form.getElementsByTagName("input"),s=0;s<t.length;s++)"submit"==t[s].getAttribute("type")&&(t[s].disabled=e!==!1)},validate:function(){var e="",t=":SEPARATOR:",s=this.form.REVIEW_RATE.value+t+this.form.REVIEW_TEXT_plus.value+t+this.form.REVIEW_TEXT_minus.value+t+this.form.REVIEW_TEXT_comment.value,i=this.form.REVIEW_TEXT_plus.value.length+this.form.REVIEW_TEXT_comment.value.length+this.form.REVIEW_TEXT_comment.value.length,a=64e3;return this.form.TITLE&&this.form.TITLE.value.length<=0&&(e+=BX.message("no_topic_name")),i<=0?e+=BX.message("no_message"):i>a&&(e+=BX.message("max_len").replace(/#MAX_LENGTH#/gi,a).replace(/#LENGTH#/gi,i)),""!==e?(alert(e),!1):(this.form.REVIEW_TEXT.value=s,!0)},busy:!1,send:function(){return this.busy!==!0&&(this.busy=!0,this.form.elements.dataType||this.form.appendChild(BX.create("input",{props:{type:"hidden",name:"dataType",value:"json"}})),BX.onCustomEvent(this.form,"onRequest",[this.form,this]),BX.ajax.submitAjax(this.form,{method:"POST",url:this.form.action,dataType:"json",onsuccess:this.onsuccess,onfailure:this.onfailure}),!0)},onsuccess:function(e){this.busy=!1,this.disableButtons(!1),BX.onCustomEvent(this.form,"onResponse",[this.form,this]),this.get(e)},onfailure:function(){BX.onCustomEvent(this.form,"onResponse",[this.form,this]),BX.reload()},get:function(t){if(e.curpage=e.curpage||top.window.location.href,BX.onCustomEvent(e,"onForumCommentAJAXPost",[t,this.form]),"undefined"==typeof t||t.reload)return void BX.reload(e.curpage);if(t.status){if(t.allMessages||"undefined"!=typeof t.message)BX.onCustomEvent(this.form,"onAdd",[t.messageID,t]),this.clear();else if(t.previewMessage){var s=BX.findChild(document,{className:"reviews-preview"},!0),i=BX.findChild(document,{className:/reviews-reply-form|reviews-collapse/},!0).parentNode,a=e.fTextToNode(t.previewMessage);e.fReplaceOrInsertNode(a,s,i,{className:/reviews-reply-form|reviews-collapse/}),e.PostFormAjaxStatus(""),e.fRunScripts(t.previewMessage)}var r=t.messageID?BX("message"+t.messageID):null;r&&BX.scrollToNode(r),$.fancybox.isOpen&&setTimeout(function(){$.fancybox.close(!0),BX.closeWait()},appSLine.fancyTimeout)}t.statusMessage&&e.PostFormAjaxStatus(t.statusMessage)},clear:function(){var e=BX.findChild(document,{className:"reviews-preview"},!0);e&&BX.remove(e);for(var t,s,i,a=0;(t=BX("upload_files_"+a++ +"_"+this.form.index.value))&&t;)(s=BX.findChild(t,{tagName:"input"},!0))&&BX(s)&&(i=BX.clone(s),i.value="",s.parentNode.insertBefore(i,s),s.parentNode.removeChild(s)),BX.hide(t);var r=BX.findChild(this.form,{className:"forum-upload-file-attach"},!0);r&&BX.show(r);var o=BX.findChild(this.form,{className:"reviews-upload-info"},!0);o&&BX.hide(o);var n=null,l=BX.findChild(this.form,{attr:{name:"captcha_code"}},!0),d=BX.findChild(this.form,{attr:{name:"captcha_word"}},!0),f=BX.findChild(this.form,{className:"reviews-reply-field-captcha-image"},!0);f&&(n=BX.findChild(f,{tag:"img"})),l&&d&&n&&(d.value="",BX.ajax.getCaptcha(function(e){l.value=e.captcha_sid,n.src="/bitrix/tools/captcha.php?captcha_code="+e.captcha_sid}))},show:function(){return BX.onCustomEvent(this.form,"onBeforeShow",[this]),BX.show(this.form.parentNode),BX.scrollToNode(BX.findChild(this.form,{attribute:{name:"send_button"}},!0)),BX.onCustomEvent(this.form,"onAfterShow",[this]),!1},hide:function(){return BX.onCustomEvent(this.form,"onBeforeHide",[this]),BX.hide(this.form.parentNode),BX.onCustomEvent(this.form,"onAfterHide",[this]),!1},transverse:function(e){return BX.hasClass(document.documentElement,"bx-no-touch")&&appSLine.pageWidth>=appSLine.grid.sm?$.fancybox(this.form.parentNode,$.extend({},appSLine.fancyOptions,{title:$(e.target).attr("title")})):"none"==this.form.parentNode.style.display?this.show():this.hide(),!1},quote:function(e){BX.onCustomEvent(this.form,"onPaste",[e,"QUOTE",this]);e.author||null,e.text||""},paste:function(e){BX.onCustomEvent(this.form,"onPaste",[e,"REPLY",this]);e.author||null}},t}();BX.Forum.Init=function(e){e&&"object"==typeof e&&(new t(e),new s(e,(!1)))};BX.ready(function(){if(BX.browser.IsIE()){var e,t,s,i=BX.findChildren(document,{className:"reviews-post-table"},!0);if(!i)return;for(e=0;e<i.length;e++)for(t=i[e].getElementsByTagName("*"),s=t.length;s--;)t[s].scrollWidth>t[s].offsetWidth&&(t[s].style.paddingBottom="20px",t[s].style.overflowY="hidden")}}),e.fTextToNode=function(e){var t=BX.create("div");return t.innerHTML=e,t.childNodes.length>0?t:null},e.PostFormAjaxStatus=function(t){$.fancybox.isOpen?formWrap=$.fancybox.inner.get(0):formWrap=document;var s,i=BX.findChild(formWrap,{className:"reviews-note-box"},!0,!0);if(i)for(s=0;s<=i.length;s++)BX.remove(i[s]);if(!(t.length<1)){var a=e.fTextToNode(t);if(a)if($.fancybox.isOpen){var r=BX.findChild(formWrap,{className:"reviews-reply-form"},!0);r.parentNode.insertBefore(a,r)}else{var r=BX.findChild(document,{className:"reviews-block-container"},!0);if(!r)return;for(var o=["reviews-reply-form","reviews-collapse"],n=r;(n=n.nextSibling)&&n;)if(1==n.nodeType){var l=!1;for(s=0;s<o.length;s++)if(BX.hasClass(n,o[s])){l=!0;break}if(l){n.parentNode.insertBefore(a,n);break}}}}},e.SetReviewsAjaxPostTmp=function(t){e.forumAjaxPostTmp=t},e.fReplaceOrInsertNode=function(t,s,i,a){var r=null;return!!BX.type.isDomNode(i)&&(!(!BX.type.isDomNode(t)&&!BX.type.isArray(t)&&t.length>0&&!(t=e.fTextToNode(t)))&&(BX.type.isDomNode(s)&&(i=s.parentNode,r=s.nextSibling,i.removeChild(s)),r||(r=BX.findChild(i,a,!0)),r?r.parentNode.insertBefore(t,r):i.appendChild(t),!0))},e.fRunScripts=function(e){var t=BX.processHTML(e,!0);BX.ajax.processScripts(t.SCRIPT,!0)},e.ShowLastEditReason=function(e,t){t&&(e?t.style.display="block":t.style.display="none")},e.AttachFile=function(e,t,s,i){var a=null,r=!1;e=parseInt(e),t=parseInt(t),document.getElementById("upload_files_info_"+s).style.display="block";for(var o=e;o<e+t&&(a=document.getElementById("upload_files_"+o+"_"+s),a&&null!==typeof a);o++)if("none"==a.style.display){r=!0,a.style.display="block";break}var n=!r||o>=e+t-1;n===!0&&(i.style.display="none")},e.GetSelection=function(){var t,s="";return e.getSelection?(t=e.getSelection(),s=t.toString()):document.selection&&(t=document.selection,s=t.createRange().text),s}}(window),$(document).ready(function(){var e=$(".js-stars > .icon-star"),t=e.parent(),s=0;e.on("click",function(){var e=$(this),i=e.data("index");return e.addClass("checked").siblings().removeClass("checked"),s==i?(t.removeClass("rating-"+s),s=0,!1):(0!=s?t.removeClass("rating-"+s).addClass("is-checked"):t.removeClass("is-checked"),t.find("input").val(i),t.addClass("rating-"+i),void(s=i))})});