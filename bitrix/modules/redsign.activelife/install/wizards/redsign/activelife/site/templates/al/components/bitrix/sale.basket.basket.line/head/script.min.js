"use strict";function BitrixSmallCart(){}BitrixSmallCart.prototype={activate:function(){if(this.cartElement=BX(this.cartId),this.fixedPosition="Y"==this.arParams.POSITION_FIXED,this.fixedPosition){this.cartClosed=!0,this.maxHeight=!1,this.itemRemoved=!1,this.verticalPosition=this.arParams.POSITION_VERTICAL,this.horizontalPosition=this.arParams.POSITION_HORIZONTAL,this.topPanelElement=BX("bx-panel"),this.fixAfterRender(),this.fixAfterRenderClosure=this.closure("fixAfterRender");var t=this.closure("fixCart");this.fixCartClosure=t,this.topPanelElement&&"top"==this.verticalPosition&&BX.addCustomEvent(window,"onTopPanelCollapse",t);var e=null;BX.bind(window,"resize",function(){clearTimeout(e),e=setTimeout(t,200)})}this.setCartBodyClosure=this.closure("setCartBody"),BX.addCustomEvent(window,"OnBasketChange",this.closure("refreshCart",{}))},fixAfterRender:function(){this.statusElement=BX(this.cartId+"status"),this.statusElement&&(this.cartClosed?this.statusElement.innerHTML=this.openMessage:this.statusElement.innerHTML=this.closeMessage),this.productsElement=BX(this.cartId+"products"),this.fixCart()},closure:function(t,e){var s=this;return e?function(){s[t](e)}:function(e){s[t](e)}},toggleOpenCloseCart:function(){if(this.cartClosed)BX.removeClass(this.cartElement,"bx-closed"),BX.addClass(this.cartElement,"bx-opener"),this.statusElement.innerHTML=this.closeMessage,this.cartClosed=!1,this.fixCart();else{BX.addClass(this.cartElement,"bx-closed"),BX.removeClass(this.cartElement,"bx-opener"),BX.removeClass(this.cartElement,"bx-max-height"),this.statusElement.innerHTML=this.openMessage,this.cartClosed=!0;var t=this.cartElement.querySelector("[data-role='basket-item-list']");t&&(t.style.top="auto")}setTimeout(this.fixCartClosure,100)},setVerticalCenter:function(t){var e=t/2-this.cartElement.offsetHeight/2;e<5&&(e=5),this.cartElement.style.top=e+"px"},fixCart:function(){if("hcenter"==this.horizontalPosition){var t="innerWidth"in window?window.innerWidth:document.documentElement.offsetWidth,e=t/2-this.cartElement.offsetWidth/2;e<5&&(e=5),this.cartElement.style.left=e+"px"}var s="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight;switch(this.verticalPosition){case"top":this.topPanelElement&&(this.cartElement.style.top=this.topPanelElement.offsetHeight+5+"px");break;case"vcenter":this.setVerticalCenter(s)}if(this.productsElement){var i=this.cartElement.querySelector("[data-role='basket-item-list']");this.cartClosed?this.maxHeight&&(BX.removeClass(this.cartElement,"bx-max-height"),i&&(i.style.top="auto"),this.maxHeight=!1):this.maxHeight?this.productsElement.scrollHeight==this.productsElement.clientHeight&&(BX.removeClass(this.cartElement,"bx-max-height"),i&&(i.style.top="auto"),this.maxHeight=!1):"top"==this.verticalPosition||"vcenter"==this.verticalPosition?this.cartElement.offsetTop+this.cartElement.offsetHeight>=s&&(BX.addClass(this.cartElement,"bx-max-height"),i&&(i.style.top="82px"),this.maxHeight=!0):this.cartElement.offsetHeight>=s&&(BX.addClass(this.cartElement,"bx-max-height"),i&&(i.style.top="82px"),this.maxHeight=!0),"vcenter"==this.verticalPosition&&this.setVerticalCenter(s)}},refreshCart:function(t){return this.itemRemoved?void(this.itemRemoved=!1):(t.sessid=BX.bitrix_sessid(),t.siteId=this.siteId,t.templateName=this.templateName,t.arParams=this.arParams,t.cartList=appSLine.cartList,void BX.ajax({url:this.ajaxPath,method:"POST",dataType:"html",data:t,onsuccess:this.setCartBodyClosure}))},setCartBody:function(t){this.cartElement&&(this.cartElement.innerHTML=t),this.fixedPosition&&setTimeout(this.fixAfterRenderClosure,100)},removeItemFromCart:function(t){this.refreshCart({sbblRemoveItemFromCart:t}),this.itemRemoved=!0,BX.onCustomEvent("OnBasketChange")}};