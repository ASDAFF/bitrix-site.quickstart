function JsSuggest(oHandler,sParams,sParser){var t=this;t.oObj=oHandler,t.sParams=sParams,sParser?t.sExp=new RegExp("["+sParser+"]+","i"):t.sExp=new RegExp(","),t.oLast={str:!1,arr:!1},t.oThis={str:!1,arr:!1},t.oEl={start:!1,end:!1},t.oUnfinedWords={},t.bReady=!0,t.eFocus=!0,t.aDiv=null,t.oDiv=null,t.oActive=null,t.oPointer=[],t.oPointer_default=[],t.oPointer_this="input_field",t.oObj.onblur=function(){t.eFocus=!1},t.oObj.onfocus=function(){t.eFocus||(t.eFocus=!0,setTimeout(function(){t.CheckModif("focus")},500))},t.oLast.arr=t.oObj.value.split(t.sExp),t.oLast.str=t.oLast.arr.join(":"),setTimeout(function(){t.CheckModif("this")},500),this.CheckModif=function(e){var o=!1,n=0,r=!1,i="",s={};if(t.eFocus){if(t.bReady&&t.oObj.value.length>0&&(t.oThis.arr=t.oObj.value.split(t.sExp),t.oThis.str=t.oThis.arr.join(":"),t.oThis.str&&t.oThis.str!=t.oLast.str&&(s.position=TCJsUtils.getCursorPosition(t.oObj),s.position.end>0&&!t.sExp.test(t.oObj.value.substr(s.position.end-1,1))&&(s.arr=t.oObj.value.substr(0,s.position.end).split(t.sExp),o=t.oThis.arr[s.arr.length-1],t.oEl.start=s.position.end-s.arr[s.arr.length-1].length,t.oEl.end=t.oEl.start+o.length,t.oEl.content=o,t.oLast.arr=t.oThis.arr,t.oLast.str=t.oThis.str)),o)){for(n=2;n<=o.length;n++)if(i=o.substr(0,n),"!fined"==t.oUnfinedWords[i]){r=!0;break}r||t.Send(o)}setTimeout(function(){t.CheckModif("this")},500)}},t.Send=function(sSearch){if(!sSearch)return!1;var oError=[];t.bReady=!1,BX("wait_container")&&(BX("wait_container").innerHTML=BX.message("JS_CORE_LOADING"),BX.show(BX("wait_container"))),BX.ajax.post("/bitrix/components/bitrix/search.suggest.input/search.php",{search:sSearch,params:t.sParams},function(data){var result={};t.bReady=!0;try{eval("result = "+data+";")}catch(t){oError.result_unval=t}TCJsUtils.empty(result)&&(oError.result_empty="Empty result");try{if(TCJsUtils.empty(oError)&&"object"==typeof result){if(1!=result.length||result[0].NAME!=t.oEl.content)return void t.Show(result)}else t.oUnfinedWords[t.oEl.content]="!fined"}catch(t){oError.unknown_error=t}BX("wait_container")&&BX.hide(BX("wait_container"))})},t.Show=function(e){t.Destroy(),t.oDiv=document.body.appendChild(document.createElement("DIV")),t.oDiv.id=t.oObj.id+"_div",t.oDiv.className="search-popup",t.oDiv.style.position="absolute",t.aDiv=t.Print(e);var o=TCJsUtils.GetRealPos(t.oObj);t.oDiv.style.width=parseInt(o.width)+"px",TCJsUtils.show(t.oDiv,o.left,o.bottom),TCJsUtils.addEvent(document,"click",t.CheckMouse),TCJsUtils.addEvent(document,"keydown",t.CheckKeyword)},t.Print=function(e){var o=null,n={},r=0,i=null,s=null,a=t.oDiv.id;for(var l in e)if(e.hasOwnProperty(l)){o=e[l];var c={};c.ID=o.ID&&o.ID.length>0?o.ID:r++,c.GID=a+"_"+c.ID,c.NAME=TCJsUtils.htmlspecialcharsEx(o.NAME),c.CNT=o.CNT,n[c.GID]=c,t.oPointer.push(c.GID),i=t.oDiv.appendChild(document.createElement("DIV")),i.id=c.GID,i.name=a+"_div",i.className="search-popup-row",i.onmouseover=function(){t.Init(),this.className="search-popup-row-active"},i.onmouseout=function(){t.Init(),this.className="search-popup-row"},i.onclick=function(){t.oActive=this.id},s=i.appendChild(document.createElement("DIV")),s.id=i.id+"_NAME",s.className="search-popup-el search-popup-el-cnt",s.innerHTML=c.CNT,s=i.appendChild(document.createElement("DIV")),s.id=i.id+"_NAME",s.className="search-popup-el search-popup-el-name",s.innerHTML=c.NAME}return t.oPointer.push("input_field"),t.oPointer_default=t.oPointer,n},t.Destroy=function(){try{TCJsUtils.hide(t.oDiv),t.oDiv.parentNode.removeChild(t.oDiv)}catch(t){}t.aDiv=[],t.oPointer=[],t.oPointer_default=[],t.oPointer_this="input_field",t.bReady=!0,t.eFocus=!0,t.oActive=null,TCJsUtils.removeEvent(document,"click",t.CheckMouse),TCJsUtils.removeEvent(document,"keydown",t.CheckKeyword)},t.Replace=function(){if("string"==typeof t.oActive){var e=t.aDiv[t.oActive],o="";if("object"==typeof e){var n=document.createElement("span");n.innerHTML=e.NAME.replace(/&quot;/g,'"').replace(/&amp;/g,"&"),o=n.innerHTML}for(var r=t.oEl.start;r<t.oObj.value.length&&" "==t.oObj.value.substring(r,r+1);)r++;t.oObj.value=t.oObj.value.substring(0,r)+o.replace(/&lt;/g,"<").replace(/&gt;/g,">")+t.oObj.value.substr(t.oEl.end),TCJsUtils.setCursorPosition(t.oObj,r+o.length)}},t.Init=function(){t.oActive=!1,t.oPointer=t.oPointer_default,t.Clear(),t.oPointer_this="input_pointer"},t.Clear=function(){var e=t.oDiv.getElementsByTagName("div");if(e.length>0&&"object"==typeof e)for(var o in e)if(e.hasOwnProperty(o)){var n=e[o];n&&"object"==typeof n&&n.name==t.oDiv.id+"_div"&&(n.className="search-popup-row")}},t.CheckMouse=function(){t.Replace(),t.Destroy()},t.CheckKeyword=function(e){e||(e=window.event);var o=null,n=null;if(37<e.keyCode&&e.keyCode<41||13==e.keyCode){switch(t.Clear(),e.keyCode){case 38:o=t.oPointer.pop(),t.oPointer_this==o&&(t.oPointer.unshift(o),o=t.oPointer.pop()),"input_field"!=o&&(t.oActive=o,n=document.getElementById(o),"object"==typeof n&&(n.className="search-popup-row-active")),t.oPointer.unshift(o);break;case 40:o=t.oPointer.shift(),t.oPointer_this==o&&(t.oPointer.push(o),o=t.oPointer.shift()),"input_field"!=o&&(t.oActive=o,n=document.getElementById(o),"object"==typeof n&&(n.className="search-popup-row-active")),t.oPointer.push(o);break;case 39:t.Replace(),t.Destroy();break;case 13:t.Replace(),t.Destroy()}t.oPointer_this=o}else t.Destroy()}}var TCJsUtils={arEvents:[],addEvent:function(t,e,o){t.attachEvent?t.attachEvent("on"+e,o):t.addEventListener?t.addEventListener(e,o,!1):t["on"+e]=o,this.arEvents[this.arEvents.length]={element:t,event:e,fn:o}},removeEvent:function(t,e,o){t.detachEvent?t.detachEvent("on"+e,o):t.removeEventListener?t.removeEventListener(e,o,!1):t["on"+e]=null},getCursorPosition:function(t){var e={start:0,end:0};if(!t||"object"!=typeof t)return e;try{if(null!=document.selection&&null==t.selectionStart){t.focus();for(var o=document.selection.createRange(),n=o.parentElement(),r=o.getBookmark(),i=t.value,s=t.value,a="__"+Math.random()+"__";i.indexOf(a)!=-1;)a="__"+Math.random()+"__";return!n||null==n||"textarea"!=n.type&&"text"!=n.type?e:(o.text=a+o.text+a,i=t.value,e.start=i.indexOf(a),i=i.replace(a,""),e.end=i.indexOf(a),t.value=s,o.moveToBookmark(r),o.select(),e)}return{start:t.selectionStart,end:t.selectionEnd}}catch(t){}return e},setCursorPosition:function(t,e){if("object"!=typeof t)return!1;t.focus();try{if(null!=document.selection&&null==t.selectionStart){var o=document.selection.createRange();o.select()}else t.selectionStart=e,t.selectionEnd=e;return!0}catch(t){return!1}},printArray:function(t,e,o){try{var n="",r="";void 0==o&&(o=0),e||(e="\n");for(var i=0;i<=o;i++)r+="  ";for(var s in t)t.hasOwnProperty(s)&&(n+="object"==typeof t[s]?r+s+" = {"+e+TCJsUtils.printArray(t[s],e,o+1)+", "+e+"}"+e:r+s+" = "+t[s]+"; "+e);return n}catch(t){}},empty:function(t){var e=!0;if(t)for(var o in t)if(t.hasOwnProperty(o)){e=!1;break}return e},show:function(t,e,o){if("object"==typeof t){var n=parseInt(t.style.zIndex);return(n<=0||isNaN(n))&&(n=100),t.style.zIndex=n,t.style.left=e+"px",t.style.top=o+"px",t}},hide:function(t){t&&(t.style.display="none")},GetRealPos:function(t){if(!t||!t.offsetParent)return!1;var e={},o=t.offsetParent;for(e.left=t.offsetLeft,e.top=t.offsetTop;o&&"BODY"!=o.tagName;)e.left+=o.offsetLeft,e.top+=o.offsetTop,o=o.offsetParent;return e.right=e.left+t.offsetWidth,e.bottom=e.top+t.offsetHeight,e.width=t.offsetWidth,e.height=t.offsetHeight,e},htmlspecialcharsEx:function(t){return t.replace(/&amp;/g,"&amp;amp;").replace(/&lt;/g,"&amp;lt;").replace(/&gt;/g,"&amp;gt;").replace(/&quot;/g,"&amp;quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},htmlspecialcharsback:function(t){return t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")}};