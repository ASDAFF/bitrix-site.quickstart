function JsSuggestSale(oHandler,sParams,sParser,domain,ssubmit){var t=this,tmp=0;t.oObj=oHandler,t.sParams=sParams,t.domain=domain,t.submit=ssubmit,sParser?t.sExp=new RegExp("["+sParser+"]+","i"):t.sExp=new RegExp(","),t.oLast={str:!1,arr:!1},t.oThis={str:!1,arr:!1},t.oEl={start:!1,end:!1},t.oUnfinedWords={},t.bReady=!0,t.eFocus=!0,t.aDiv=null,t.oDiv=null,t.oActive=null,t.oPointer=Array(),t.oPointer_default=Array(),t.oPointer_this="input_field",t.oObj.onblur=function(){t.eFocus=!1},t.oObj.onfocus=function(){t.eFocus||(t.eFocus=!0,setTimeout(function(){t.CheckModif("focus")},500))},t.oLast.arr=t.oObj.value.split(t.sExp),t.oLast.str=t.oLast.arr.join(":"),setTimeout(function(){t.CheckModif("this")},500),this.CheckModif=function(e){var o=!1,r=0,n=!1,s="",i={};if(t.eFocus){if(t.bReady&&t.oObj.value.length>0&&(t.oThis.arr=t.oObj.value.split(t.sExp),t.oThis.str=t.oThis.arr.join(":"),t.oThis.str&&t.oThis.str!=t.oLast.str&&(i.position=TCJsUtils.getCursorPosition(t.oObj),i.position.end>0&&!t.sExp.test(t.oObj.value.substr(i.position.end-1,1))&&(i.arr=t.oObj.value.substr(0,i.position.end).split(t.sExp),o=t.oThis.arr[i.arr.length-1],t.oEl.start=i.position.end-i.arr[i.arr.length-1].length,t.oEl.end=t.oEl.start+o.length,t.oEl.content=o,t.oLast.arr=t.oThis.arr,t.oLast.str=t.oThis.str)),o)){for(r=2;r<=o.length;r++)if(s=o.substr(0,r),"!fined"==t.oUnfinedWords[s]){n=!0;break}n||t.Send(o)}setTimeout(function(){t.CheckModif("this")},500)}},t.Send=function(sSearch){if(!sSearch)return!1;var TID=null,oError=Array();t.bReady=!1,PShowWaitMessage("wait_container",!0),TID=CPHttpRequest.InitThread(),CPHttpRequest.SetAction(TID,function(data){var result={};t.bReady=!0;try{eval("result = "+data+";")}catch(t){oError.result_unval=t}TCJsUtils.empty(result)&&(oError.result_empty="Empty result");try{if(TCJsUtils.empty(oError)&&"object"==typeof result){if(1!=result.length||result[0].NAME!=t.oEl.content)return void t.Show(result)}else t.oUnfinedWords[t.oEl.content]="!fined"}catch(t){oError.unknown_error=t}PCloseWaitMessage("wait_container",!0)}),url="/bitrix/components/bitrix/sale.ajax.locations/search.php",t.domain&&(url=domain+"/bitrix/components/bitrix/sale.ajax.locations/search.php"),CPHttpRequest.Send(TID,url,{search:sSearch,params:t.sParams})},t.Show=function(e){t.Destroy(),t.oDiv=document.body.appendChild(document.createElement("DIV")),t.oDiv.id=t.oObj.id+"_div",t.oDiv.className="search-popup",t.oDiv.style.position="absolute",t.aDiv=t.Print(e);var o=TCJsUtils.GetRealPos(t.oObj);t.oDiv.style.width="auto",TCJsUtils.show(t.oDiv,o.left,o.bottom),TCJsUtils.addEvent(document,"click",t.CheckMouse),TCJsUtils.addEvent(document,"keydown",t.CheckKeyword)},t.Print=function(e){var o=null,r="",n=Array(),s=Array(),i=0,a=0,l=null,c=null;r=t.oDiv.id;for(a in e)o=e[a],s=Array(),s.ID=o.ID&&o.ID.length>0?o.ID:i++,s.GID=r+"_"+s.ID,locName=o.NAME,o.REGION_NAME.length>0&&locName.length<=0?locName=o.REGION_NAME:o.REGION_NAME.length>0&&(locName=locName+", "+o.REGION_NAME),o.COUNTRY_NAME.length>0&&locName.length<=0?locName=o.COUNTRY_NAME:o.COUNTRY_NAME.length>0&&(locName=locName+", "+o.COUNTRY_NAME),s.NAME=TCJsUtils.htmlspecialcharsEx(locName),n[s.GID]=s,t.oPointer.push(s.GID),l=t.oDiv.appendChild(document.createElement("DIV")),l.id=s.GID,l.name=r+"_div",l.className="search-popup-row",l.onmouseover=function(){t.Init(),this.className="search-popup-row-active"},l.onmouseout=function(){t.Init(),this.className="search-popup-row"},l.onclick=function(){t.oActive=this.id},c=l.appendChild(document.createElement("DIV")),c.id=l.id+"_NAME",c.className="search-popup-el search-popup-el-name",c.innerHTML=s.NAME;return t.oPointer.push("input_field"),t.oPointer_default=t.oPointer,n},t.Destroy=function(){try{TCJsUtils.hide(t.oDiv),t.oDiv.parentNode.removeChild(t.oDiv)}catch(t){}t.aDiv=Array(),t.oPointer=Array(),t.oPointer_default=Array(),t.oPointer_this="input_field",t.bReady=!0,t.eFocus=!0,oError={},t.oActive=null,TCJsUtils.removeEvent(document,"click",t.CheckMouse),TCJsUtils.removeEvent(document,"keydown",t.CheckKeyword)},t.Replace=function(){if("string"==typeof t.oActive){var tmp=t.aDiv[t.oActive],tmp1="";if("object"==typeof tmp){var elEntities=document.createElement("span");elEntities.innerHTML=TCJsUtils.htmlspecialcharsback(tmp.NAME),tmp1=elEntities.innerHTML;var n=t.oObj.name.substr(0,t.oObj.name.length-4);document.getElementById(n).value=tmp.ID,t.submit&&t.submit.length>0&&eval(t.submit)}for(var start=t.oEl.start;start<t.oObj.value.length&&" "==t.oObj.value.substring(start,start+1);)start++;t.oObj.value=t.oObj.value.substring(0,start)+tmp1+t.oObj.value.substr(t.oEl.end),TCJsUtils.setCursorPosition(t.oObj,start+tmp1.length)}},t.Init=function(){t.oActive=!1,t.oPointer=t.oPointer_default,t.Clear(),t.oPointer_this="input_pointer"},t.Clear=function(){var e={},o="";if(e=t.oDiv.getElementsByTagName("div"),e.length>0&&"object"==typeof e)for(o in e){var r=e[o];r&&"object"==typeof r&&r.name==t.oDiv.id+"_div"&&(r.className="search-popup-row")}},t.CheckMouse=function(){t.Replace(),t.Destroy()},t.CheckKeyword=function(e){e||(e=window.event);var o=null,r=null;if(37<e.keyCode&&e.keyCode<41||13==e.keyCode){switch(t.Clear(),e.keyCode){case 38:o=t.oPointer.pop(),t.oPointer_this==o&&(t.oPointer.unshift(o),o=t.oPointer.pop()),"input_field"!=o&&(t.oActive=o,r=document.getElementById(o),"object"==typeof r&&(r.className="search-popup-row-active")),t.oPointer.unshift(o);break;case 40:o=t.oPointer.shift(),t.oPointer_this==o&&(t.oPointer.push(o),o=t.oPointer.shift()),"input_field"!=o&&(t.oActive=o,r=document.getElementById(o),"object"==typeof r&&(r.className="search-popup-row-active")),t.oPointer.push(o);break;case 39:t.Replace(),t.Destroy();break;case 13:t.Replace(),t.Destroy()}t.oPointer_this=o}else t.Destroy()}}"object"!=typeof oObject&&(window.oObject={});var TCJsUtils={arEvents:Array(),addEvent:function(t,e,o){t.attachEvent?t.attachEvent("on"+e,o):t.addEventListener?t.addEventListener(e,o,!1):t["on"+e]=o,this.arEvents[this.arEvents.length]={element:t,event:e,fn:o}},removeEvent:function(t,e,o){t.detachEvent?t.detachEvent("on"+e,o):t.removeEventListener?t.removeEventListener(e,o,!1):t["on"+e]=null},getCursorPosition:function(t){var e={start:0,end:0};if(!t||"object"!=typeof t)return e;try{if(null!=document.selection&&null==t.selectionStart){t.focus();for(var o=document.selection.createRange(),r=o.parentElement(),n=o.getBookmark(),s=sContents_=t.value,i="__"+Math.random()+"__";s.indexOf(i)!=-1;)i="__"+Math.random()+"__";return!r||null==r||"textarea"!=r.type&&"text"!=r.type?e:(o.text=i+o.text+i,s=t.value,e.start=s.indexOf(i),s=s.replace(i,""),e.end=s.indexOf(i),t.value=sContents_,o.moveToBookmark(n),o.select(),e)}return{start:t.selectionStart,end:t.selectionEnd}}catch(t){}return e},setCursorPosition:function(t,e){if("object"!=typeof t)return!1;t.focus();try{if(null!=document.selection&&null==t.selectionStart){var o=document.selection.createRange();o.select()}else t.selectionStart=e,t.selectionEnd=e;return!0}catch(t){return!1}},printArray:function(t,e,o){try{var r="",n="",s=null,i=0;for(void 0==o&&(o=0),e||(e="\n"),i=0;i<=o;i++)n+="  ";for(s in t)r+="object"==typeof t[s]?n+s+" = {"+e+TCJsUtils.printArray(t[s],e,o+1)+", "+e+"}"+e:n+s+" = "+t[s]+"; "+e;return r}catch(t){return}},empty:function(t){var e=!0;if(t)for(i in t){e=!1;break}return e},show:function(t,e,o){if("object"==typeof t){var r=parseInt(t.style.zIndex);return(r<=0||isNaN(r))&&(r=100),t.style.zIndex=r,t.style.left=e+"px",t.style.top=o+"px",t}},hide:function(t){t&&(t.style.display="none")},GetRealPos:function(t){if(!t||!t.offsetParent)return!1;var e=Array(),o=t.offsetParent;for(e.left=t.offsetLeft,e.top=t.offsetTop;o&&"BODY"!=o.tagName;)e.left+=o.offsetLeft,e.top+=o.offsetTop,o=o.offsetParent;return e.right=e.left+t.offsetWidth,e.bottom=e.top+t.offsetHeight,e.width=t.offsetWidth,e.height=t.offsetHeight,e},htmlspecialcharsEx:function(t){return res=t.replace(/&amp;/g,"&amp;amp;").replace(/&lt;/g,"&amp;lt;").replace(/&gt;/g,"&amp;gt;").replace(/&quot;/g,"&amp;quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),res},htmlspecialcharsback:function(t){return res=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;;/g,'"').replace(/&amp;/g,"&"),res}};SuggestLoadedSale=!0;